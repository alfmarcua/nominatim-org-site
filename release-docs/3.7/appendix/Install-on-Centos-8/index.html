<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://nominatim.org/appendix/Install-on-Centos-8/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Installation on CentOS 8 - Nominatim 3.7.2</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  <link href="../../styles.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Installation on CentOS 8";
    var mkdocs_page_input_path = "appendix/Install-on-Centos-8.md";
    var mkdocs_page_url = "/appendix/Install-on-Centos-8/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Nominatim 3.7.2</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Search/">Search</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Reverse/">Reverse</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Lookup/">Address Lookup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Details/">Details</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Status/">Status</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Output/">Place Output Formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Faq/">FAQ</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Administration Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Installation/">Basic Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Import/">Import</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Update/">Update</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Deployment/">Deploy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Setup-Nominatim-UI/">Nominatim UI</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Advanced-Installations/">Advanced Installations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Migration/">Migration from older Versions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../admin/Faq/">Troubleshooting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developers Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Development-Environment/">Setup for Development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/overview/">Architecture Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Import/">OSM Data Import</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Ranking/">Place Ranking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Postcodes/">Postcodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Testing/">Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/data-sources/">External Data Sources</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Appendix</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../Install-on-Centos-7/">Installation on CentOS 7</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Installation on CentOS 8</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Install-on-Ubuntu-18/">Installation on Ubuntu 18</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Install-on-Ubuntu-20/">Installation on Ubuntu 20</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Nominatim 3.7.2</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendix &raquo;</li>
        
      
    
    <li>Installation on CentOS 8</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/openstreetmap/Nominatim/edit/master/docs/appendix/Install-on-Centos-8.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <p><em>Note:</em> these installation instructions are also available in executable
        form for use with vagrant under <code>vagrant/Install-on-Centos-8.sh</code>.</p>
<h1 id="installing-the-required-software">Installing the Required Software<a class="headerlink" href="#installing-the-required-software" title="Permanent link">ÔÉÅ</a></h1>
<p>These instructions expect that you have a freshly installed CentOS version 8.
Make sure all packages are up-to-date by running:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo dnf update -y</span>
</code></pre></div>

<p>The standard CentOS repositories don't contain all the required packages,
you need to enable the EPEL repository as well. For example for SELinux
related redhat-hardened-cc1 package. To enable it on CentOS run:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo dnf install -y epel-release redhat-rpm-config</span>
</code></pre></div>

<p>EPEL contains Postgres 9.6 and 10, but not PostGIS. Postgres 9.4+/10/11/12
and PostGIS 2.4/2.5/3.0 are availble from postgresql.org</p>
<div class="codehilite"><pre><span></span><code><span class="n">sudo</span> <span class="n">dnf</span> <span class="o">-</span><span class="n">qy</span> <span class="n">module</span> <span class="n">disable</span> <span class="n">postgresql</span>
<span class="n">sudo</span> <span class="n">dnf</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">postgresql</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">yum</span><span class="o">/</span><span class="n">reporpms</span><span class="o">/</span><span class="n">EL</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">pgdg</span><span class="o">-</span><span class="n">redhat</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">latest</span><span class="o">.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>
<span class="k">export</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">pgsql</span><span class="o">-</span><span class="mi">12</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="p">:</span><span class="o">$</span><span class="n">PATH</span>
</code></pre></div>

<p>Now you can install all packages needed for Nominatim:</p>
<div class="codehilite"><pre><span></span><code>sudo dnf --enablerepo<span class="o">=</span>powertools install -y postgresql12-server <span class="se">\</span>
                    postgresql12-contrib postgresql12-devel postgis30_12 <span class="se">\</span>
                    wget git cmake make gcc gcc-c++ libtool policycoreutils-python-utils <span class="se">\</span>
                    llvm-toolset ccache clang-tools-extra <span class="se">\</span>
                    php-pgsql php php-intl php-json libpq-devel <span class="se">\</span>
                    bzip2-devel proj-devel boost-devel <span class="se">\</span>
                    python3-pip python3-setuptools python3-devel <span class="se">\</span>
                    expat-devel zlib-devel libicu-devel

pip3 install --user psycopg2-binary python-dotenv psutil Jinja2 PyICU
</code></pre></div>

<h1 id="system-configuration">System Configuration<a class="headerlink" href="#system-configuration" title="Permanent link">ÔÉÅ</a></h1>
<p>The following steps are meant to configure a fresh CentOS installation
for use with Nominatim. You may skip some of the steps if you have your
OS already configured.</p>
<h2 id="creating-dedicated-user-accounts">Creating Dedicated User Accounts<a class="headerlink" href="#creating-dedicated-user-accounts" title="Permanent link">ÔÉÅ</a></h2>
<p>Nominatim will run as a global service on your machine. It is therefore
best to install it under its own separate user account. In the following
we assume this user is called nominatim and the installation will be in
/srv/nominatim. To create the user and directory run:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim</span>
</code></pre></div>

<p>You may find a more suitable location if you wish.</p>
<p>To be able to copy and paste instructions from this manual, export
user name and home directory now like this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span> <span class="n">USERNAME</span><span class="o">=</span><span class="n">nominatim</span>
<span class="k">export</span> <span class="n">USERHOME</span><span class="o">=/</span><span class="n">srv</span><span class="o">/</span><span class="n">nominatim</span>
</code></pre></div>

<p><strong>Never, ever run the installation as a root user.</strong> You have been warned.</p>
<p>Make sure that system servers can read from the home directory:</p>
<div class="codehilite"><pre><span></span><code><span class="err">chmod a+x $USERHOME</span>
</code></pre></div>

<h2 id="setting-up-postgresql">Setting up PostgreSQL<a class="headerlink" href="#setting-up-postgresql" title="Permanent link">ÔÉÅ</a></h2>
<p>CentOS does not automatically create a database cluster. Therefore, start
with initializing the database, then enable the server to start at boot:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo /usr/pgsql-12/bin/postgresql-12-setup initdb</span>
<span class="err">sudo systemctl enable postgresql-12</span>
</code></pre></div>

<p>Next tune the postgresql configuration, which is located in 
<code>/var/lib/pgsql/data/postgresql.conf</code>. See section <em>Postgres Tuning</em> in
<a href="../../admin/Installation/#postgresql-tuning">the installation page</a>
for the parameters to change.</p>
<p>Now start the postgresql service after updating this config file.</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo systemctl restart postgresql-12</span>
</code></pre></div>

<p>Finally, we need to add two postgres users: one for the user that does
the import and another for the webserver which should access the database
only for reading:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo -u postgres createuser -s $USERNAME</span>
<span class="err">sudo -u postgres createuser apache</span>
</code></pre></div>

<h1 id="installing-nominatim">Installing Nominatim<a class="headerlink" href="#installing-nominatim" title="Permanent link">ÔÉÅ</a></h1>
<h2 id="building-and-configuration">Building and Configuration<a class="headerlink" href="#building-and-configuration" title="Permanent link">ÔÉÅ</a></h2>
<p>Get the source code for the release and unpack it</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> <span class="nv">$USERHOME</span>
wget https://nominatim.org/release/Nominatim-3.7.2.tar.bz2
tar xf Nominatim-3.7.2.tar.bz2
</code></pre></div>

<p>The code must be built in a separate directory. Create this directory,
then configure and build Nominatim in there:</p>
<div class="codehilite"><pre><span></span><code>mkdir <span class="nv">$USERHOME</span>/build
<span class="nb">cd</span> <span class="nv">$USERHOME</span>/build

cmake <span class="nv">$USERHOME</span>/Nominatim-3.7.2

cmake /home/vagrant/Nominatim

make
sudo make install
</code></pre></div>

<h2 id="setting-up-the-apache-webserver">Setting up the Apache Webserver<a class="headerlink" href="#setting-up-the-apache-webserver" title="Permanent link">ÔÉÅ</a></h2>
<p>The webserver should serve the php scripts from the website directory of your
<a href="../../admin/Import/#creating-the-project-directory">project directory</a>.
Therefore set up a project directory and populate the website directory:</p>
<div class="codehilite"><pre><span></span><code><span class="err">mkdir $USERHOME/nominatim-project</span>
<span class="err">cd $USERHOME/nominatim-project</span>
<span class="err">nominatim refresh --website</span>
</code></pre></div>

<p>You need to create an alias to the website directory in your apache
configuration. Add a separate nominatim configuration to your webserver:</p>
<div class="codehilite"><pre><span></span><code>sudo tee /etc/httpd/conf.d/nominatim.conf <span class="s">&lt;&lt; EOFAPACHECONF</span>
<span class="s">&lt;Directory &quot;$USERHOME/nominatim-project/website&quot;&gt;</span>
<span class="s">  Options FollowSymLinks MultiViews</span>
<span class="s">  AddType text/html   .php</span>
<span class="s">  DirectoryIndex search.php</span>
<span class="s">  Require all granted</span>
<span class="s">&lt;/Directory&gt;</span>

<span class="s">Alias /nominatim $USERHOME/nominatim-project/website</span>
<span class="s">EOFAPACHECONF</span>
</code></pre></div>

<p>Then reload apache</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo systemctl enable httpd</span>
<span class="err">sudo systemctl restart httpd</span>
</code></pre></div>

<h2 id="adding-selinux-security-settings">Adding SELinux Security Settings<a class="headerlink" href="#adding-selinux-security-settings" title="Permanent link">ÔÉÅ</a></h2>
<p>It is a good idea to leave SELinux enabled and enforcing, particularly
with a web server accessible from the Internet. At a minimum the
following SELinux labeling should be done for Nominatim:</p>
<div class="codehilite"><pre><span></span><code><span class="err">sudo semanage fcontext -a -t httpd_sys_content_t &quot;/usr/local/lib/nominatim/lib-php(/.*)?&quot;</span>
<span class="err">sudo semanage fcontext -a -t httpd_sys_content_t &quot;$USERHOME/nominatim-project/website(/.*)?&quot;</span>
<span class="err">sudo semanage fcontext -a -t lib_t &quot;$USERHOME/nominatim-project/module/nominatim.so&quot;</span>
<span class="err">sudo restorecon -R -v /usr/local/lib64/nominatim</span>
<span class="err">sudo restorecon -R -v $USERHOME/nominatim-project</span>
</code></pre></div>

<p>You need to create a minimal configuration file that tells nominatim
the name of your webserver user:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span> <span class="nv">NOMINATIM_DATABASE_WEBUSER</span><span class="o">=</span><span class="s2">&quot;apache&quot;</span> <span class="p">|</span> tee .env
</code></pre></div>

<p>Nominatim is now ready to use. Continue with
<a href="../../admin/Import/">importing a database from OSM data</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Install-on-Ubuntu-18/" class="btn btn-neutral float-right" title="Installation on Ubuntu 18">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Install-on-Centos-7/" class="btn btn-neutral" title="Installation on CentOS 7"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/openstreetmap/Nominatim/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../Install-on-Centos-7/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Install-on-Ubuntu-18/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
